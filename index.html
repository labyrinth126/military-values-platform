<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è»äººæ ¸å¿ƒåƒ¹å€¼è§€å¯¦è¸å¹³å°</title>
    <style>
        /* (å¤§éƒ¨åˆ† CSS èˆ‡å‰ç‰ˆç›¸åŒ) */
        body { font-family: 'Helvetica Neue', 'Microsoft JhengHei', sans-serif; background-color: #f0f2f5; margin: 0; color: #333; }
        .container { width: 100%; max-width: 1200px; margin: 20px auto; background-color: #fff; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); overflow: hidden; }
        #notification { position: fixed; top: -100px; left: 50%; transform: translateX(-50%); padding: 15px 30px; border-radius: 8px; color: white; font-size: 1.1em; z-index: 2000; transition: top 0.5s ease-in-out; box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
        #notification.show { top: 20px; }
        #notification.success { background-color: #28a745; }
        #notification.error { background-color: #dc3545; }
        .action-card { background: #fff; border: 1px solid #ddd; border-radius: 8px; padding: 20px; margin-bottom: 25px; }

        /* **æ–°å¢ï¼šæ•™å¸«æ¨¡å¼å°ˆç”¨æ¨£å¼** */
        .teacher-info {
            display: none; /* é è¨­éš±è— */
            font-size: 0.9em;
            color: #6c757d;
            margin-top: 10px;
        }

        /* ç•¶ body æ¨™ç±¤æœ‰ teacher-view é€™å€‹ class æ™‚ï¼Œé¡¯ç¤ºæ•™å¸«è³‡è¨Š */
        body.teacher-view .teacher-info {
            display: block;
        }
        
        /* (å…¶é¤˜ CSS çœç•¥...) */
        #login-screen { padding: 50px; text-align: center; }
        #login-screen h1 { color: #003366; }
        #login-screen select, #login-screen input { width: 80%; max-width: 300px; padding: 12px; margin-top: 15px; border: 1px solid #ccc; border-radius: 5px; font-size: 1em; }
        #login-screen button { padding: 12px 30px; font-size: 1.1em; margin-top: 20px; background-color: #005a9c; color: white; border: none; border-radius: 5px; cursor: pointer; }
        #app-screen { display: none; }
        header { background-color: #003366; color: white; padding: 15px 30px; display: flex; justify-content: space-between; align-items: center; }
        header h1 { margin: 0; font-size: 1.5em; }
        header #user-info { font-size: 1em; }
        header #logout-btn { background: #e74c3c; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; }
        main { display: flex; }
        .sidebar { width: 250px; background: #f8f9fa; padding: 20px; border-right: 1px solid #e0e0e0; }
        .content { flex: 1; padding: 30px; max-height: 85vh; overflow-y: auto; }
        .author-info .author { font-weight: bold; color: #005a9c; }
        .author-info .class-tag { display: inline-block; background: #6c757d; color: white; padding: 3px 10px; border-radius: 12px; font-size: 0.8em; margin-left: 8px; }
        .value-tag { display: inline-block; background: #e9ecef; color: #495057; padding: 5px 10px; border-radius: 15px; font-size: 0.9em; }
        .action-text { margin-top: 15px; font-size: 1.1em; line-height: 1.6; }
        .action-footer { margin-top: 20px; border-top: 1px solid #eee; padding-top: 15px; display: flex; align-items: center; }
        .like-button { cursor: pointer; padding: 8px 15px; border-radius: 20px; background-color: #e9ecef; border: 1px solid #ddd; }
        .like-button:disabled { background-color: #f8f9fa; color: #6c757d; cursor: default; border-color: #e9ecef; }
    </style>
</head>
<body>
    <div id="notification"></div>
    <div class="container">...</div>
    <div id="write-action-modal" class="modal">...</div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script>
        // --- å·²å¹«æ‚¨è²¼ä¸Šæ‚¨çš„ Firebase è¨­å®š ---
        const firebaseConfig = {
            apiKey: "AIzaSyAyv_LTTc8NyKaRUgQsxHEVPQKg5msjbP8",
            authDomain: "military-core-values.firebaseapp.com",
            projectId: "military-core-values",
            storageBucket: "military-core-values.appspot.com",
            messagingSenderId: "16059765404",
            appId: "1:16059765404:web:dd1a1b894fdfe775ba9359",
            measurementId: "G-NZ1HBTWHMG"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
    </script>
    
    <script>
        // (å¤§éƒ¨åˆ† JS ç¨‹å¼ç¢¼èˆ‡å‰ç‰ˆç›¸åŒ)
        const coreValues = { "å¿ èª ": "...", "è²¬ä»»": "...", ... };
        let userClass = null, userStudentId = null, selectedValue = null, unsubscribe, userLikes = new Set(), notificationTimeout;

        // **ä¿®æ”¹ 1: renderActions å‡½å¼ï¼ŒåŠ å…¥æ•™å¸«è³‡è¨Šçš„ HTML çµæ§‹**
        function renderActions(actionsData) {
            const displayArea = document.getElementById('actions-display-area');
            displayArea.innerHTML = '<h3>å¤§å®¶çš„å¯¦è¸åˆ†äº«</h3>';
            if (actionsData.length === 0) { displayArea.innerHTML += '<p>é€™å€‹åˆ†é¡ç›®å‰æ²’æœ‰åˆ†äº«ã€‚</p>'; return; }
            
            actionsData.forEach(action => {
                const card = document.createElement('div');
                card.className = 'action-card';

                const isLiked = userLikes.has(action.id);
                const isOwnPost = action.authorId === userStudentId;
                
                // æ ¼å¼åŒ–æ™‚é–“
                let formattedTime = 'è®€å–ä¸­...';
                if (action.createdAt && typeof action.createdAt.toDate === 'function') {
                    const date = action.createdAt.toDate();
                    const y = date.getFullYear();
                    const m = String(date.getMonth() + 1).padStart(2, '0');
                    const d = String(date.getDate()).padStart(2, '0');
                    const h = String(date.getHours()).padStart(2, '0');
                    const min = String(date.getMinutes()).padStart(2, '0');
                    formattedTime = `${y}-${m}-${d} ${h}:${min}`;
                }
                
                // æ±ºå®šæŒ‰éˆ•æ¨£å¼
                let likeButtonHTML;
                if (isOwnPost) {
                    likeButtonHTML = `<button class="like-button" disabled title="é€™æ˜¯æ‚¨è‡ªå·±çš„æ–‡ç« ">ğŸ‘ ${action.likes || 0}</button>`;
                } else {
                    likeButtonHTML = `<button class="like-button ${isLiked ? 'liked' : ''}" onclick="likeAction('${action.id}', '${action.authorId}', this)" ${isLiked ? 'disabled' : ''}>ğŸ‘ ${action.likes || 0}</button>`;
                }

                // çµ„åˆæœ€çµ‚çš„ HTML
                card.innerHTML = `
                    <div class="action-card-header">
                        <div class="author-info">
                            <span class="author">${action.authorId}</span>
                            <span class="class-tag">${action.class}</span>
                        </div>
                        <span class="value-tag">${action.value}</span>
                    </div>
                    <p class="action-text">${action.text}</p>
                    
                    <div class="teacher-info">
                        æäº¤æ™‚é–“: ${formattedTime}
                    </div>

                    <div class="action-footer">${likeButtonHTML}</div>`;
                displayArea.appendChild(card);
            });
        }
        
        // **ä¿®æ”¹ 2: æ–°å¢å•Ÿå‹•æ•™å¸«æ¨¡å¼çš„ç›¸é—œç¨‹å¼ç¢¼**
        // æª¢æŸ¥ç¶²å€ä¸­æ˜¯å¦æœ‰ ?mode=teacher
        function checkTeacherModeFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('mode') === 'teacher') {
                document.body.classList.add('teacher-view');
                showNotification('å·²é€²å…¥æ•™å¸«ç°¡å ±æ¨¡å¼', 'success');
            }
        }

        // ç›£è½éµç›¤å¿«æ·éµ
        document.addEventListener('keydown', function(event) {
            // ç•¶ Ctrl + Alt + T è¢«åŒæ™‚æŒ‰ä¸‹æ™‚
            if (event.ctrlKey && event.altKey && event.key === 't') {
                event.preventDefault(); // é˜²æ­¢è§¸ç™¼ç€è¦½å™¨é è¨­è¡Œç‚º
                document.body.classList.toggle('teacher-view'); // åˆ‡æ› teacher-view class
                if (document.body.classList.contains('teacher-view')) {
                    showNotification('å·²é–‹å•Ÿæ•™å¸«ç°¡å ±æ¨¡å¼', 'success');
                } else {
                    showNotification('å·²é—œé–‰æ•™å¸«ç°¡å ±æ¨¡å¼', 'success');
                }
            }
        });

        // é é¢è¼‰å…¥æ™‚å°±æª¢æŸ¥ä¸€æ¬¡ç¶²å€
        window.onload = checkTeacherModeFromURL;
        
        // (å…¶é¤˜æ‰€æœ‰ JS å‡½å¼ï¼Œå¦‚ enterPlatform, logout, filterActions, submitAction ç­‰ï¼Œç¶­æŒä¸è®Š)
    </script>
</body>
</html>
