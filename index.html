<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>軍人核心價值觀實踐平台</title>
    <style>
        /* (大部分 CSS 與前版相同) */
        body { font-family: 'Helvetica Neue', 'Microsoft JhengHei', sans-serif; background-color: #f0f2f5; margin: 0; color: #333; }
        .container { width: 100%; max-width: 1200px; margin: 20px auto; background-color: #fff; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); overflow: hidden; }
        #notification { position: fixed; top: -100px; left: 50%; transform: translateX(-50%); padding: 15px 30px; border-radius: 8px; color: white; font-size: 1.1em; z-index: 2000; transition: top 0.5s ease-in-out; box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
        #notification.show { top: 20px; }
        #notification.success { background-color: #28a745; }
        #notification.error { background-color: #dc3545; }
        .action-card { background: #fff; border: 1px solid #ddd; border-radius: 8px; padding: 20px; margin-bottom: 25px; }

        /* **新增：教師模式專用樣式** */
        .teacher-info {
            display: none; /* 預設隱藏 */
            font-size: 0.9em;
            color: #6c757d;
            margin-top: 10px;
        }

        /* 當 body 標籤有 teacher-view 這個 class 時，顯示教師資訊 */
        body.teacher-view .teacher-info {
            display: block;
        }
        
        /* (其餘 CSS 省略...) */
        #login-screen { padding: 50px; text-align: center; }
        #login-screen h1 { color: #003366; }
        #login-screen select, #login-screen input { width: 80%; max-width: 300px; padding: 12px; margin-top: 15px; border: 1px solid #ccc; border-radius: 5px; font-size: 1em; }
        #login-screen button { padding: 12px 30px; font-size: 1.1em; margin-top: 20px; background-color: #005a9c; color: white; border: none; border-radius: 5px; cursor: pointer; }
        #app-screen { display: none; }
        header { background-color: #003366; color: white; padding: 15px 30px; display: flex; justify-content: space-between; align-items: center; }
        header h1 { margin: 0; font-size: 1.5em; }
        header #user-info { font-size: 1em; }
        header #logout-btn { background: #e74c3c; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; }
        main { display: flex; }
        .sidebar { width: 250px; background: #f8f9fa; padding: 20px; border-right: 1px solid #e0e0e0; }
        .content { flex: 1; padding: 30px; max-height: 85vh; overflow-y: auto; }
        .author-info .author { font-weight: bold; color: #005a9c; }
        .author-info .class-tag { display: inline-block; background: #6c757d; color: white; padding: 3px 10px; border-radius: 12px; font-size: 0.8em; margin-left: 8px; }
        .value-tag { display: inline-block; background: #e9ecef; color: #495057; padding: 5px 10px; border-radius: 15px; font-size: 0.9em; }
        .action-text { margin-top: 15px; font-size: 1.1em; line-height: 1.6; }
        .action-footer { margin-top: 20px; border-top: 1px solid #eee; padding-top: 15px; display: flex; align-items: center; }
        .like-button { cursor: pointer; padding: 8px 15px; border-radius: 20px; background-color: #e9ecef; border: 1px solid #ddd; }
        .like-button:disabled { background-color: #f8f9fa; color: #6c757d; cursor: default; border-color: #e9ecef; }
    </style>
</head>
<body>
    <div id="notification"></div>
    <div class="container">...</div>
    <div id="write-action-modal" class="modal">...</div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script>
        // --- 已幫您貼上您的 Firebase 設定 ---
        const firebaseConfig = {
            apiKey: "AIzaSyAyv_LTTc8NyKaRUgQsxHEVPQKg5msjbP8",
            authDomain: "military-core-values.firebaseapp.com",
            projectId: "military-core-values",
            storageBucket: "military-core-values.appspot.com",
            messagingSenderId: "16059765404",
            appId: "1:16059765404:web:dd1a1b894fdfe775ba9359",
            measurementId: "G-NZ1HBTWHMG"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
    </script>
    
    <script>
        // (大部分 JS 程式碼與前版相同)
        const coreValues = { "忠誠": "...", "責任": "...", ... };
        let userClass = null, userStudentId = null, selectedValue = null, unsubscribe, userLikes = new Set(), notificationTimeout;

        // **修改 1: renderActions 函式，加入教師資訊的 HTML 結構**
        function renderActions(actionsData) {
            const displayArea = document.getElementById('actions-display-area');
            displayArea.innerHTML = '<h3>大家的實踐分享</h3>';
            if (actionsData.length === 0) { displayArea.innerHTML += '<p>這個分類目前沒有分享。</p>'; return; }
            
            actionsData.forEach(action => {
                const card = document.createElement('div');
                card.className = 'action-card';

                const isLiked = userLikes.has(action.id);
                const isOwnPost = action.authorId === userStudentId;
                
                // 格式化時間
                let formattedTime = '讀取中...';
                if (action.createdAt && typeof action.createdAt.toDate === 'function') {
                    const date = action.createdAt.toDate();
                    const y = date.getFullYear();
                    const m = String(date.getMonth() + 1).padStart(2, '0');
                    const d = String(date.getDate()).padStart(2, '0');
                    const h = String(date.getHours()).padStart(2, '0');
                    const min = String(date.getMinutes()).padStart(2, '0');
                    formattedTime = `${y}-${m}-${d} ${h}:${min}`;
                }
                
                // 決定按鈕樣式
                let likeButtonHTML;
                if (isOwnPost) {
                    likeButtonHTML = `<button class="like-button" disabled title="這是您自己的文章">👍 ${action.likes || 0}</button>`;
                } else {
                    likeButtonHTML = `<button class="like-button ${isLiked ? 'liked' : ''}" onclick="likeAction('${action.id}', '${action.authorId}', this)" ${isLiked ? 'disabled' : ''}>👍 ${action.likes || 0}</button>`;
                }

                // 組合最終的 HTML
                card.innerHTML = `
                    <div class="action-card-header">
                        <div class="author-info">
                            <span class="author">${action.authorId}</span>
                            <span class="class-tag">${action.class}</span>
                        </div>
                        <span class="value-tag">${action.value}</span>
                    </div>
                    <p class="action-text">${action.text}</p>
                    
                    <div class="teacher-info">
                        提交時間: ${formattedTime}
                    </div>

                    <div class="action-footer">${likeButtonHTML}</div>`;
                displayArea.appendChild(card);
            });
        }
        
        // **修改 2: 新增啟動教師模式的相關程式碼**
        // 檢查網址中是否有 ?mode=teacher
        function checkTeacherModeFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('mode') === 'teacher') {
                document.body.classList.add('teacher-view');
                showNotification('已進入教師簡報模式', 'success');
            }
        }

        // 監聽鍵盤快捷鍵
        document.addEventListener('keydown', function(event) {
            // 當 Ctrl + Alt + T 被同時按下時
            if (event.ctrlKey && event.altKey && event.key === 't') {
                event.preventDefault(); // 防止觸發瀏覽器預設行為
                document.body.classList.toggle('teacher-view'); // 切換 teacher-view class
                if (document.body.classList.contains('teacher-view')) {
                    showNotification('已開啟教師簡報模式', 'success');
                } else {
                    showNotification('已關閉教師簡報模式', 'success');
                }
            }
        });

        // 頁面載入時就檢查一次網址
        window.onload = checkTeacherModeFromURL;
        
        // (其餘所有 JS 函式，如 enterPlatform, logout, filterActions, submitAction 等，維持不變)
    </script>
</body>
</html>
